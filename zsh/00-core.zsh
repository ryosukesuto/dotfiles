#!/usr/bin/env zsh
# ============================================================================
# 00-core.zsh - Zshコア設定
# ============================================================================
# このファイルはZshの基本的な動作設定と履歴管理を行います。

# ============================================================================
# 基本的な環境設定
# ============================================================================
# カラー出力を有効化
export CLICOLOR=1

# キーバインディング（Emacsスタイル）
bindkey -e

# ============================================================================
# シェルオプション
# ============================================================================
# 基本設定
setopt no_beep              # ビープ音を無効化
setopt print_eight_bit      # 日本語ファイル名を正しく表示
setopt no_flow_control      # Ctrl+S/Ctrl+Qを無効化（画面固まり防止）

# グロブ機能
setopt extended_glob        # 拡張グロブ機能（**/*.txt等）
setopt no_null_glob        # マッチしないグロブはそのまま残す
setopt no_nomatch          # パターンマッチエラーを出さない

# ============================================================================
# 履歴設定
# ============================================================================
# 履歴ファイル設定
export HISTFILE="${HOME}/.zsh_history"
export HISTSIZE=50000
export SAVEHIST=50000

# 履歴ファイルのパーミッション（セキュリティ）
if [[ ! -f "$HISTFILE" ]]; then
  touch "$HISTFILE"
  chmod 600 "$HISTFILE"
fi

# 履歴オプション
setopt share_history        # セッション間で履歴を共有
setopt append_history       # 履歴を追記（上書きしない）
setopt hist_ignore_dups     # 直前と同じコマンドは記録しない
setopt hist_ignore_all_dups # 既存の履歴と重複するコマンドは古い方を削除
setopt hist_reduce_blanks   # 余分な空白を削除
setopt extended_history     # 実行時刻も記録
setopt hist_expire_dups_first # 履歴が満杯になったら重複を優先的に削除
setopt hist_find_no_dups    # 履歴検索で重複を表示しない
setopt hist_verify         # 履歴展開後に実行前確認