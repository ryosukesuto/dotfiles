# Wiz Triage

Wizアラートのトリアージと調査を支援するskill。

## 起動トリガー

- 「Wizアラート」「Wiz対応」「セキュリティアラート」などの発言
- Wizのアラート内容が貼り付けられたとき

## ワークフロー

### Phase 1: Linear Issue作成

アラート内容から以下を抽出してLinear issueを作成:

| 項目 | 設定値 |
|------|--------|
| Team | `Platform` |
| Title | `[Wiz {Severity}] {リソース名}: {検出内容の要約}` |
| Assignee | `me` |
| Estimate | `2` (調査込みの通常作業) |
| Cycle | `current` |
| State | `Todo` |
| Project | `Wiz 対応` |

Description テンプレート:
```markdown
## アラート概要

{アラートの説明}

| 項目 | 内容 |
|------|------|
| Severity | {High/Critical} |
| 検出日時 | {日時} |
| リソース | {リソース名} |
| MITRE ATT&CK | {該当する場合} |

### 検出内容

{詳細}

---

## 調査結果

(調査後に記入)

---

## 結論

| 項目 | 結果 |
|------|------|
| 脆弱性有無 | |
| 被害有無 | |
| 対応 | |
```

### Phase 2: 調査ガイド

アラートタイプに応じた調査観点を提示:

#### Threats（脅威）の場合
1. **ログ調査**
   - Datadogでサービスログを確認
   - GCP Cloud Loggingで詳細確認
   - 検出時刻前後のリクエストパターン分析

2. **コード調査**（必要に応じて）
   - 該当機能のコードを確認
   - 脆弱性の有無を判断

3. **関連情報確認**
   - Bug Bounty報告の有無
   - 同様のアラートの過去事例

#### Risk Issue（リスク課題）の場合
1. **設定確認**
   - 該当リソースの設定を確認
   - 意図した設定かどうか判断

2. **影響範囲確認**
   - 他に同様の設定がないか確認

### Phase 3: 結果出力

調査完了後、以下を出力:

1. **Linear issueの更新**
   - 調査結果セクションを記入
   - 結論を記入

2. **Wiz用コメント**
   - `/tmp/wiz-comment-{issue番号}.txt` に出力

テンプレート:
```
調査の結果、{脆弱性あり/なし}と判断。

【原因】
{原因の説明}

【判断理由】
- {理由1}
- {理由2}

Linear: {issueのURL}
```

3. **対応方針の提示**
   - 脆弱性なし → Wizで「無視」、issueをDone
   - 脆弱性あり → 対応計画を立案、issueは継続

## 参考情報

### Wizステータスの選択

| 状況 | Wizステータス | Linear |
|------|--------------|--------|
| 脆弱性なし | 無視（理由記載必須） | Done |
| 対応完了 | 対応済み | Done |
| 対応中 | Open | In Progress |

### よくあるアラートタイプと対応

| アラート | よくある原因 | 対応 |
|----------|-------------|------|
| DNS query for Burp Suite domains | MXレコード検証、メール送信機能 | 機能の正常動作なら無視 |
| IMDS access | GCP認証トークン取得 | 正常動作なら無視 |
| Suspicious outbound connection | 外部API呼び出し | 意図した通信か確認 |
