# PRレビュー詳細リファレンス

`/review-pr`コマンドの詳細ガイドライン。

## コードレビューの目的

1. バグの早期発見 - 本番障害を防ぐダブルチェック
2. 品質の担保 - 将来を見据えた保守性・拡張性の確保
3. 情報共有 - チーム内での変更の周知と影響確認

## 優先度分類

### P0 (Blocking) - マージ前に必須
- セキュリティ脆弱性（認証/認可、SQLi、XSS、CSRF）
- データ損失リスク（削除、破壊的変更）
- 重大なバグ（クラッシュ、機能停止）
- APIの破壊的変更

### P1 (Urgent) - 次のサイクルで対応
- パフォーマンス問題（N+1クエリ、メモリリーク）
- 重要なエラーハンドリング不足
- テストカバレッジの欠如（重要な機能）

### P2 (Normal) - いずれ修正
- 設計上の改善（責務分離、拡張性）
- 保守性の向上（重複コード、複雑な関数）
- ドキュメント問題

### P3 (Low) - 余裕があれば
- 命名の改善
- コメントの追加・削除
- 軽微なリファクタリング

## レビュー観点チェックリスト

### セキュリティ（P0優先）
- 認証・認可ロジックの実装が適切か
- 入力検証が全てのエンドポイントで実装されているか
- 機密情報がハードコードされていないか
- SQLi、XSS、CSRFなどの脆弱性がないか

### パフォーマンス（P1優先）
- N+1クエリ問題がないか
- 非効率なアルゴリズムが使用されていないか
- キャッシュ戦略が適切か

### 正確性（P0-P1）
- PRの目的と実装内容が一致しているか
- エッジケースの処理が実装されているか
- エラーハンドリングが適切か

### 保守性・可読性（P2-P3）
- ファイル・モジュール分割が適切か
- 関数が単一の責務に集中しているか
- 重複コードがないか

### 過剰設計（P2-P3）
- YAGNI違反がないか（現時点で不要な抽象化・設定・拡張ポイント）
- 1箇所でしか使わないヘルパー・ユーティリティを作っていないか
- 将来の仮定に基づいた設計をしていないか（実需要のないインターフェース分離等）
- フレームワークや内部コードが保証する範囲を二重チェックしていないか

### テスト（P1-P2）
- 重要な機能に対するテストが実装されているか
- エッジケースのカバーがあるか
- テスト容易性が確保されているか

## 避けるべきレビュー

- 曖昧な指摘（何をどう改善するか不明）
- 理由なしの指摘
- このPRで導入されていない既存の問題
- 個人的好み（チーム合意がない主観的スタイル）
- 意見が分かれるスタイル（早期リターン vs ガード節など）

## 評価基準

- 10点: 完璧、ベストプラクティス完全準拠
- 8-9点: 軽微な改善のみ、即座にマージ可能
- 6-7点: いくつかの改善必要、大きな問題なし
- 4-5点: 重要な修正必要、再レビュー推奨
- 3点以下: 大幅な見直し必要、マージ不可

## 技術スタック別の観点

### フロントエンド
- パフォーマンス（バンドルサイズ、レンダリング効率）
- アクセシビリティ（WCAG準拠）
- レスポンシブデザイン、クロスブラウザ対応

### バックエンド
- API設計（RESTful/GraphQL原則）
- エラーハンドリング（HTTPステータス、リトライ）
- データベース設計（正規化、インデックス）

### インフラ・DevOps
- リソース効率性（コスト最適化）
- 監視・ロギング
- セキュリティ設定（IAM、ネットワーク）

## タイムボックス目安

- 小規模PR（<100行）: 10-15分
- 中規模PR（100-300行）: 20-30分
- 大規模PR（300行+）: 45-60分、または分割レビューを提案
