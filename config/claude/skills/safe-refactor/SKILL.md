---
name: safe-refactor
description: テストカバレッジを維持しながら段階的で安全なリファクタリング実行
user-invocable: true
allowed-tools:
  - Read
  - Edit
  - Write
  - Bash
  - Glob
  - Grep
---

# /safe-refactor - 安全なリファクタリング実行

## 目的
テストカバレッジを維持しながら、段階的で安全なリファクタリングを実行します。

## 動作
1. 事前チェック:
   - 現在のテストが全て通ることを確認
   - コードカバレッジを記録
   - lintエラーがないことを確認

2. リファクタリング計画:
   - 変更の影響範囲を分析
   - 小さなステップに分解
   - 各ステップでのテスト戦略を立案

3. 段階的実行:
   - Step 1: 変数名・関数名のリネーム
   - Step 2: 重複コードの抽出
   - Step 3: 複雑な条件分岐の簡略化
   - Step 4: デザインパターンの適用
   - 各ステップ後にテスト実行

4. 検証:
   - 全テストが通過することを確認
   - カバレッジが低下していないことを確認
   - パフォーマンスの劣化がないことを確認

5. ロールバック準備:
   - 各段階でgit commitを作成
   - 問題発生時は即座に前の状態に戻せる

## 使用例
```
/safe-refactor
```

## 安全機能
- 各ステップで自動的にテスト実行
- カバレッジ低下時は警告
- 破壊的変更の前に確認プロンプト
- ロールバック用のチェックポイント作成
