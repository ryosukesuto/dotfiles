# /til コマンド設計書

## 1. 概要

- 一言サマリ: Claude Codeセッションから技術的な学びを抽出し、Obsidianデイリーノートに記録するスラッシュコマンド
- 担当: Claude Code
- 保存先: `~/.claude/commands/til.md`

## 2. 背景・問題設定

- 現状の課題
  - `th`コマンドは1行メモ向けで、構造化された技術的学びの記録に不向き
  - Claude Codeセッションで得た知見が散逸しがち
  - 後から振り返り可能な形式で記録されていない

- なぜ今対応するのか
  - 日々の開発作業で得た学びを資産化したい
  - Obsidianのデイリーノートを「学び」中心のフォーマットに変更したい

## 3. 目的・ゴール

- Claude Codeセッション中に `/til` で即座に学びを記録できる
- Obsidian最適化された形式（タグ、内部リンク）で保存される
- 2件目以降は同じデイリーノートに追記される

## 4. スコープ

### 4.1 対象
- `/til` スラッシュコマンドの新規作成
- 01_Dailyデイリーノートへの学び記録機能

### 4.2 非スコープ
- 既存の`th`コマンドの修正・削除（別途対応）
- 複数セッションの履歴読み込み（現在のセッションのみ）
- 過去のデイリーノートのフォーマット変更

## 5. 要件

### 5.1 機能要件

1. コマンド呼び出し
   - `/til` - 現在のセッションから学びを抽出
   - `/til Fastlyのactivate設定` - 特定トピックを指定

2. 学びの抽出
   - 現在のセッションの会話から技術的な学びを抽出
   - 事象 → 調査プロセス → 発見 → 学び の構造で整理

3. ファイル操作
   - 保存先: `~/gh/github.com/ryosukesuto/obsidian-notes/01_Daily/YYYY-MM-DD.md`
   - ファイルがなければ作成
   - 存在すれば `---` 区切りで追記

### 5.2 非機能要件

- Obsidian最適化
  - 階層タグ: `#til/fastly`, `#til/tmux`, `#til/terraform` など
  - 内部リンク: 関連技術やツールへの `[[リンク]]`
  - 絵文字: 見出しに適切な絵文字を使用

## 6. 現状構成（As-Is）

```
現在のデイリーノート形式:
# YYYY-MM-DD

## 📝 メモ
- タイムスタンプ: 1行メモ
- タイムスタンプ: 1行メモ
```

## 7. 提案する構成（To-Be）

### 7.1 新しいデイリーノート形式

```markdown
# YYYY-MM-DD

## 💡 Fastly: activateフラグとサービス状態
#til/fastly #til/terraform

### 事象
`stg.example.com` にアクセスすると以下のエラー:
> Fastly error: unknown domain: stg.example.com

### 調査
1. [[Terraform]]の設定ファイルを確認
2. 動作している `api-stg.example.com` と比較
3. `activate` 変数のデフォルト値確認

### 発見
| サービス | activate設定 | 状態 |
|----------|-------------|------|
| api-stg.example.com | `true` | 動作 |
| stg.example.com | 未設定 | 停止 |

### 学び
- [[Fastly]]の `activate = false` はサービスをドラフト状態にする
- 「unknown domain」エラーはDNSではなくFastly側の設定が原因の場合がある
- 新規サービス作成時は `activate = true` を明示的に設定する

---

## 💡 tmux-manager.sh: プロセス検知の問題
#til/tmux #til/bash

### 事象
...
```

### 7.2 スラッシュコマンド実装

保存先: `~/.claude/commands/til.md`

処理フロー:
1. 現在の日付を取得
2. デイリーノートのパスを構築
3. セッションから学びを抽出・整形
4. ファイルに書き込み（作成 or 追記）

### 7.3 タグ体系

```
#til/
├── aws
├── terraform
├── fastly
├── tmux
├── bash
├── git
├── claude-code
└── obsidian
```

## 8. トレードオフと選択理由

### 検討した代替案

| 方式 | メリット | デメリット |
|------|---------|-----------|
| A: スラッシュコマンド | コンテキスト参照可能、明示的呼び出し | 実装が必要 |
| B: Skills | 自動判断で実行 | 学び記録は明示的に呼び出したい |
| C: thコマンド改修 | 既存資産活用 | 1行メモと構造化学びは用途が違う |

### 採用理由
- 方式A（スラッシュコマンド）を採用
- 理由: 学びの記録は意図的に行うものであり、明示的な呼び出しが適切

## 9. リスクと対応方針

| リスク | 対応策 |
|--------|--------|
| 学びの抽出精度 | トピック指定オプションで補完 |
| ファイル破損 | 追記前に内容確認、バックアップ不要（git管理） |

## 10. オープンな論点

- [ ] `th`コマンドは削除する？それとも1行メモ用に残す？
- [ ] デイリーノートに「📝 メモ」セクションは残す？
