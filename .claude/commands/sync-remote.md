---
description: リモートブランチと現在のブランチを同期
---

# リモートブランチとの同期

現在のブランチをリモートの最新状態に同期します。Terraformリポジトリのブランチ戦略に基づいて、安全にリモートの変更を取り込みます。

## 現在の状態確認
! git status --porcelain
! git branch --show-current
! git log --oneline -1 HEAD

## 同期プロセスの実行

1. **未コミットの変更を退避**
   - ローカルの変更がある場合は一時的にstashに保存

2. **リモートから最新の変更を取得**
   ```bash
   git fetch sandbox --prune
   ```

3. **現在のブランチをリモートにリベース**
   ```bash
   git pull --rebase sandbox $(git branch --show-current)
   ```

4. **退避した変更を再適用**
   - stashした変更がある場合は再適用

5. **不要なローカルブランチの削除**
   - リモートで削除されたブランチに対応するローカルブランチを表示
   ```bash
   git branch -vv | grep ': gone]' | awk '{print $1}'
   ```
   - 安全に削除可能なマージ済みブランチを確認
   ```bash
   git branch --merged | grep -v "\*" | grep -v "main" | grep -v "master" | grep -v "sandbox"
   ```
   - 削除対象のブランチがある場合は、削除コマンドを提示（自動削除はしない）

6. **結果の確認**
   - コンフリクトがある場合は解決方法を提示
   - 正常に同期できた場合は更新内容をサマリー表示
   - 削除可能なブランチがある場合はリストアップ

## 注意事項
- マージコミットを避けるため、常にリベースを使用
- コンフリクトが発生した場合は、手動での解決が必要
- force pushが必要な場合は事前に確認を求める
- ブランチの削除は安全性のため自動実行せず、コマンドを提示するのみ
- `--prune`オプションでリモートで削除されたブランチの追跡情報を自動削除